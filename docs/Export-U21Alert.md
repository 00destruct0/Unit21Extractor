# Export-U21Alert

## SYNOPSIS
Exports alerts from Unit21 to a local file.

## SYNTAX
```powershell
Export-U21Alert -ApiKey <string> -StartDate <string> -OutputPath <string>
               [-EndDate <string>] [-BaseUri <string>] [-Summary] [-Verbose]
```

## DESCRIPTION
Triggers a bulk export of alerts from Unit21, monitors the export job until completion, and downloads the resulting ZIP file. The entire workflow is automated: initiating the export, polling for status, retrieving the download URL, and saving the file to disk.

 
> ðŸ“ **Report Generation Behavior**  
> Unless otherwise specified, a **detailed report** (`is_summary=false`) is generated.  
> To generate a summary report, use the `-Summary` switch.



## PARAMETERS

### -ApiKey (Required)
The Unit21 API key. Must have `read:alerts` and `read:datafile_uploads` permissions.

### -StartDate (Required)
Alert creation start date. Must be in ISO format: `YYYY-MM-DD`.

### -EndDate (Optional)
Alert creation end date. Must be in ISO format: `YYYY-MM-DD`. Defaults to today.

### -OutputPath (Required)
The local file path where the export file will be saved. Recommended extension: `.zip`.

### -BaseUri (Optional)
The Unit21 API base URL. Defaults to `https://api.prod2.unit21.com/v1`.
Useful for switching environments. Use the Environment Discovery script
(`Test-U21Connection.ps1`) to determine the correct URL for your API key.

### -Summary (Optional)
Specifying this switch generates a summary report. If the switch is not provided, a detailed report is generated by default.

### -Verbose (Optional)
Enables detailed progress output showing each step of the export workflow.
Recommended for first-time use and troubleshooting.

## EXAMPLES

### Example 1: Basic export (detailed report by default)
```powershell
Export-U21Alert -ApiKey "your-key" -StartDate "2026-02-12" -OutputPath "C:\Exports\alerts.zip"
```

### Example 2: Date range with verbose output
```powershell
Export-U21Alert -ApiKey "your-key" -StartDate "2026-02-01" -EndDate "2026-02-13" `
    -OutputPath "C:\Exports\alerts.zip" -Verbose
```

### Example 3: Summary report
```powershell
Export-U21Alert -ApiKey "your-key" -StartDate "2026-02-12" `
    -OutputPath "C:\Exports\alerts_summary.zip" -Summary
```

### Example 4: Extract the ZIP contents after download
```powershell
Export-U21Alert -ApiKey "your-key" -StartDate "2026-02-12" -OutputPath "C:\Exports\alerts.zip"
Expand-Archive -Path "C:\Exports\alerts.zip" -DestinationPath "C:\Exports\alerts\"
```

## API DETAILS
- **Endpoint:** `POST /v1/alerts/bulk-export`
- **Date filter fields:** `start_date` / `end_date` (inside `filters` object)
- **Permission:** `read:alerts`, `read:datafile_uploads`

## OUTPUT FORMAT
The downloaded file is a ZIP archive containing multiple CSV files. The primary
alert data and all related objects are included as separate CSV files within the ZIP.

## REQUIRED PERMISSIONS
- `read:alerts` - Required to initiate the alert export
- `read:datafile_uploads` - Required to list and download the export file

## ERROR HANDLING
- **HTTP 400**: Bad request - check filter parameters.
- **HTTP 401**: Unauthorized - invalid API key or wrong environment.
  Use `Test-U21Connection.ps1` to verify your API key and environment.
- **HTTP 403**: Forbidden - key lacks required permissions.
- **HTTP 429**: Automatic retry with exponential backoff.
- **HTTP 500/503**: Automatic retry with exponential backoff.
- **Timeout**: Terminating error if export does not complete within 30 minutes.

## NOTES
- The `-Verbose` flag is recommended to monitor export progress.
- Alerts use `start_date`/`end_date` filter fields (not `created_at_start`/`created_at_end`).
- Default report type is **detailed** (`is_summary=false`). Use `-Summary` for the summary report.
- Default API environment is Production 2 (`https://api.prod2.unit21.com/v1`).
